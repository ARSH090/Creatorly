{
  "meta": {
    "project": "Creatorly",
    "date": "2026-02-21",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "Creatorly is an Indian-first creator monetization platform that lets creators build storefronts, sell digital products, automate DM & email flows, and securely deliver purchased assets. It bundles onboarding, product management, payments (Razorpay/Stripe/PayPal), webhooks, admin tools and delivery into one integrated dashboard.",
  "core_goals": [
    "Enable creators to launch a customizable storefront and sell digital products quickly with secure delivery.",
    "Provide Indian payment integrations (Razorpay primarily) with reliable webhook-driven fulfillment and subscription/trial handling.",
    "Offer creator-side management (products, orders, analytics) and platform admin controls (users, plans, webhooks) securely and auditable.",
    "Support automation: AutoDM, email sequences and queue-based delivery to minimize manual fulfilment.",
    "Ship an MVP that ensures secure file storage (S3 presigned URLs), webhook idempotency, and strong auth/session handling."
  ],
  "features": [
    {
      "name": "Authentication & Onboarding",
      "description": "Phone/Google-based signup, OTP verification, onboarding steps and session management; endpoints expose profile and onboarding actions.",
      "user_flows": [
        "POST /api/auth/send-otp with body { phone: '+91XXXXXXXXXX' } -> Receive 200 { success: true, message: 'OTP_SENT' }",
        "POST /api/onboarding/complete with onboarding data + Razorpay mandate token -> Receive 201 { success: true, userId }",
        "GET /api/auth/me with valid auth cookie/JWT -> Receive 200 { success: true, data: userProfile }",
        "GET /api/auth/me without Authorization or cookie -> Receive 401 { success: false, error: 'Unauthorized' }",
        "POST /api/auth/send-otp with invalid phone format -> Receive 400 { success: false, error: 'INVALID_PHONE' }"
      ]
    },
    {
      "name": "Product Management (Creator CRUD & Uploads)",
      "description": "Creator-facing APIs to create, list and manage digital products, generate S3 presigned upload URLs, and reorder or publish products.",
      "user_flows": [
        "POST /api/products with valid auth and body { name, price, productType, ... } -> Receive 201 { success: true, data: { productId } }",
        "POST /api/upload/product-file with valid auth and { productId, filename, contentType } -> Receive 200 { success: true, data: { presignedUrl, key } }",
        "PUT /api/products/:id with valid auth to attach uploaded fileKey -> Receive 200 { success: true, data: updatedProduct }",
        "GET /api/products with valid auth -> Receive 200 { success: true, data: [ ...creatorProducts ] }",
        "POST /api/products with valid auth but missing required field (name) -> Receive 400 { success: false, error: 'ValidationError', code: 'NAME_REQUIRED' }",
        "POST /api/upload/product-file with file > plan limit -> Receive 413 { success: false, error: 'FILE_TOO_LARGE' }"
      ]
    },
    {
      "name": "Payment Webhooks & Order Fulfillment",
      "description": "Server webhook listeners (Razorpay, Stripe, PayPal) verify signatures, enforce idempotency, create orders and trigger secure delivery (signed S3 URLs + emails).",
      "user_flows": [
        "POST /api/webhooks/razorpay with raw body and valid x-razorpay-signature header -> Receive 200 { received: true }",
        "POST /api/webhooks/razorpay with valid signature (payment captured event) -> Receive 200 { received: true } -> GET /api/orders/:id with admin/creator auth to confirm order created -> Receive 200 { success: true, data: { orderId, status: 'completed' } }",
        "POST /api/webhooks/razorpay with invalid signature -> Receive 400 { success: false, error: 'Invalid signature' }"
      ]
    },
    {
      "name": "Admin Dashboard (Analytics & User Control)",
      "description": "Platform admin endpoints to view revenue/analytics, manage users (suspend/unsuspend), update plans and inspect webhook logs for auditing.",
      "user_flows": [
        "GET /api/admin/analytics with admin auth -> Receive 200 { success: true, data: { revenue, mrr, growth } }",
        "PATCH /api/admin/users/[id]/suspend with admin auth and body { suspend: true } -> Receive 200 { success: true, data: { userId, isSuspended: true } }",
        "GET /api/admin/analytics with non-admin token -> Receive 403 { success: false, error: 'Forbidden' }",
        "PATCH /api/admin/users/[id]/suspend with missing/invalid admin token -> Receive 401 { success: false, error: 'Unauthorized' }"
      ]
    },
    {
      "name": "Digital Delivery (Secure Download Links)",
      "description": "Issue and validate time-limited download tokens and return S3 presigned URLs (or redirect) to allow buyers to download purchased digital assets securely with download count/expiry enforced.",
      "user_flows": [
        "GET /api/download/[token] with valid token -> Receive 302 redirect to S3 presigned URL (expires per product settings)",
        "GET /api/download/[token] with valid token -> Receive 302 redirect to S3 presigned URL -> GET <S3 presigned URL> -> Receive 200 with file stream",
        "GET /api/download/[token] with expired or invalid token -> Receive 404 { success: false, error: 'Download token not found or expired' }"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "backend",
    "tech_stack": [
      "TypeScript",
      "Next.js 14 (App Router)",
      "MongoDB (Mongoose)",
      "Clerk (Auth)",
      "Razorpay, Stripe, PayPal (Payments)",
      "Resend, BullMQ (Email & Queues)",
      "AWS S3 (Storage)",
      "Socket.io (Real-time)"
    ],
    "features": [
      {
        "name": "Authentication (Clerk)",
        "description": "User registration, login, and session management via Clerk.",
        "files": [
          "src/lib/auth/server-auth.ts",
          "src/middleware.ts"
        ],
        "endpoints": [
          {
            "method": "GET",
            "path": "/api/auth/me",
            "description": "Fetch current authenticated user profile",
            "auth_required": true
          }
        ]
      },
      {
        "name": "Product Management",
        "description": "Creator-facing CRUD for digital products, including file uploads and pricing.",
        "files": [
          "src/app/api/products/route.ts",
          "src/lib/models/Product.ts"
        ],
        "endpoints": [
          {
            "method": "GET",
            "path": "/api/products",
            "description": "List creator's products",
            "auth_required": true
          },
          {
            "method": "POST",
            "path": "/api/products",
            "description": "Create new digital product",
            "auth_required": true
          }
        ]
      },
      {
        "name": "Payment Webhooks",
        "description": "Listeners for Razorpay, Stripe, and PayPal payment success events to trigger fulfillment.",
        "files": [
          "src/app/api/webhooks/razorpay/route.ts",
          "src/app/api/webhooks/stripe/route.ts",
          "src/lib/services/digitalDelivery.ts"
        ],
        "endpoints": [
          {
            "method": "POST",
            "path": "/api/webhooks/razorpay",
            "description": "Handle Razorpay payment captured events",
            "auth_required": false
          }
        ]
      },
      {
        "name": "Admin Dashboard",
        "description": "Platform-wide management of users, stores, payouts, and system settings.",
        "files": [
          "src/app/api/admin/users/route.ts",
          "src/app/api/admin/payouts/route.ts",
          "src/app/api/admin/settings/route.ts",
          "src/lib/models/AuditLog.ts"
        ],
        "endpoints": [
          {
            "method": "GET",
            "path": "/api/admin/analytics",
            "description": "Platform-wide revenue and growth metrics",
            "auth_required": true
          },
          {
            "method": "PATCH",
            "path": "/api/admin/users/[id]/suspend",
            "description": "Suspend/Unsuspend user store",
            "auth_required": true
          }
        ]
      },
      {
        "name": "Digital Delivery",
        "description": "Secure delivery of files, license keys, and course access after purchase.",
        "files": [
          "src/app/api/download/[token]/route.ts",
          "src/lib/models/DownloadToken.ts"
        ],
        "endpoints": [
          {
            "method": "GET",
            "path": "/api/download/[token]",
            "description": "Download purchased digital asset",
            "auth_required": false
          }
        ]
      }
    ],
    "known_limitations": []
  }
}
